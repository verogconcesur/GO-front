<div class="payments" fxFill *ngIf="formTotal">
    <div class="payments__main">
        <div class="payments__main__total smaller-mat-form-fields" fxLayout="row" fxLayoutAlign=" center" [formGroup]="formTotal">
            <mat-form-field appearance="outline" floatLabel="always">
                <mat-label>{{ labels.total | translate }}</mat-label>
                <input appTwoDigitDecimal matInput formControlName="total" [readonly]="!editingTotal" />
                <span matSuffix>€</span>
                <mat-icon
                    style="cursor: pointer"
                    color="primary"
                    matPrefix
                    (click)="saveTotal(); $event.stopPropagation()"
                    *ngIf="editingTotal"
                    >check</mat-icon
                >
                <mat-icon
                    style="cursor: pointer"
                    color="primary"
                    matPrefix
                    (click)="editTotal(); $event.stopPropagation()"
                    *ngIf="!editingTotal"
                    >edit</mat-icon
                >
                <mat-error *ngIf="formTotal.get('total').invalid">
                    <span>{{ labels.maxLengthError | translate : { length: maxAmount.toString().length } }}</span>
                </mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline" floatLabel="always">
                <mat-label>{{ labels.pending | translate }}</mat-label>
                <input appTwoDigitDecimal matInput formControlName="pending" [readonly]="true" />
                <span matSuffix>€</span>
            </mat-form-field>
        </div>
        <div class="payments__main__header" *ngIf="data">
            <div class="payments__main__header__item" fxLayout="row">
                <div fxFlex="30" fxLayoutAlign="left center" fxFill>{{ labels.description | translate }}</div>
                <div fxFlex="20" fxLayoutAlign="center center" fxFill>{{ labels.paymentType | translate }}</div>
                <div fxFlex="15" fxLayoutAlign="center center" fxFill>{{ labels.amount | translate }}</div>
                <div fxFlex="20" fxLayoutAlign="center center" fxFill>{{ labels.state | translate }}</div>
                <div fxFlex="15" fxLayoutAlign="center center" fxFill>{{ labels.actions | translate }}</div>
            </div>
        </div>
        <div class="payments__main__container" fxLayout="column" *ngIf="data">
            <div
                class="payments__main__container__item smaller-mat-form-fields"
                *ngFor="let payment of paymentLines; let i = index"
                fxLayout="row"
            >
                <div fxFlex="30" fxLayoutAlign="left center">
                    <div fxLayout="column">
                        <div class="description" matTooltip="{{ payment.description }}" matTooltipPosition="above">
                            {{ payment.description }}
                        </div>
                        <div class="observation" matTooltip="{{ payment.observations }}" matTooltipPosition="above">
                            {{ payment.observations }}
                        </div>
                    </div>
                </div>
                <div fxFlex="20" fxLayoutAlign="center center">
                    {{ payment.paymentType?.name }}
                </div>
                <div fxFlex="15" fxLayoutAlign="center center">{{ payment.amount }}<span matSuffix>€</span></div>
                <div fxFlex="20" fxLayoutAlign="center center">{{ payment.paymentState?.name }}</div>
                <div fxFlex="15" fxLayoutAlign="center center" class="actions">
                    <mat-icon
                        style="cursor: pointer; color: green"
                        [matBadge]="payment.attachments?.length"
                        matBadgePosition="before"
                        (click)="!editingTotal && editPayment(payment, i)"
                        *ngIf="payment.attachments?.length"
                    >
                        attach_file
                    </mat-icon>
                    <mat-icon
                        [color]="editingTotal ? '' : 'primary'"
                        style="cursor: pointer"
                        (click)="!editingTotal && editPayment(payment, i)"
                        *ngIf="!payment.attachments?.length"
                    >
                        attach_file
                    </mat-icon>
                    <mat-icon
                        [color]="editingTotal ? '' : 'primary'"
                        style="cursor: pointer"
                        (click)="!editingTotal && sendPayment(payment)"
                        matTooltip="{{ getSendLabel(payment) | translate }}"
                        matTooltipPosition="above"
                        *ngIf="
                            payment.paymentType?.id === 5 &&
                            (payment.paymentState?.id === 1 || payment.paymentState?.id === 4 || payment.paymentState?.id === 5)
                        "
                    >
                        send
                    </mat-icon>
                    <mat-icon
                        [color]="editingTotal ? '' : 'primary'"
                        style="cursor: pointer"
                        (click)="!editingTotal && editPayment(payment, i)"
                        *ngIf="!cardInstancePaymentsConfig.disableIndividualDeleteAction"
                    >
                        edit
                    </mat-icon>
                    <mat-icon
                        [color]="editingTotal ? '' : 'primary'"
                        style="cursor: pointer"
                        (click)="!editingTotal && deletePayment(payment, i)"
                        *ngIf="!cardInstancePaymentsConfig.disableIndividualDeleteAction"
                    >
                        delete
                    </mat-icon>
                </div>
            </div>
        </div>
        <div
            class="payments__main__create"
            fxLayout="row"
            fxLayoutAlign="end none"
            *ngIf="!editing && !cardInstancePaymentsConfig.disablePaymentsAdditionAction && !editingTotal && data"
        >
            <span class="payments__main__create__item" (click)="newLine()">+ {{ labels.newLine | translate }}</span>
        </div>
    </div>
</div>
