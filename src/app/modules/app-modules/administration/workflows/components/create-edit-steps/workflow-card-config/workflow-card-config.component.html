<form [formGroup]="form" *ngIf="form" class="smaller-mat-form-fields card-config">
    <div class="card-config__item">
        <h2 class="card-config__item__title">{{ labels.boardView | translate }}</h2>
        <div class="card-config__item__card">
            <div class="card-config__item__card__colors">
                <div class="card-config__item__card__colors__color x-1"></div>
            </div>
            <div class="card-config__item__card__info">
                <section formGroupName="BOARD">
                    <section class="field-section" *ngFor="let ind of getNumberOfFields('BOARD')" [formGroupName]="'field' + ind">
                        <mat-form-field
                            appearance="outline"
                            floatLabel="always"
                            [matMenuTriggerFor]="attrSearcherMenu"
                            (click)="$event.stopPropagation(); setTabItemTo('BOARD', ind)"
                        >
                            <mat-label>{{ labels.field | translate }} {{ ind }}</mat-label>
                            <mat-select formControlName="tabItem" [placeholder]="labels.select | translate">
                                <mat-option
                                    style="display: none"
                                    *ngFor="let tabItem of originalData?.tabItems"
                                    [value]="tabItem"
                                    >{{ tabItem.frontName }}</mat-option
                                >
                            </mat-select>
                            <mat-error class="custom-actions-container__header__group__error" *ngIf="hasErrorIn('BOARD', ind)">
                                {{ labels.required | translate }}
                            </mat-error>
                        </mat-form-field>
                        <button
                            aria-label="Clear"
                            class="clear-field-button"
                            mat-icon-button
                            *ngIf="hasValue('BOARD', ind)"
                            (click)="clearField('BOARD', ind)"
                        >
                            <mat-icon>clear</mat-icon>
                        </button>
                    </section>
                </section>
            </div>
        </div>
    </div>
    <div class="card-config__item">
        <h2 class="card-config__item__title">{{ labels.calendarView | translate }}</h2>
        <div class="card-config__item__card">
            <div class="card-config__item__card__colors">
                <div class="card-config__item__card__colors__color x-1"></div>
            </div>
            <div class="card-config__item__card__info">
                <section formGroupName="CALENDAR">
                    <section
                        class="field-section"
                        *ngFor="let ind of getNumberOfFields('CALENDAR')"
                        [formGroupName]="'field' + ind"
                    >
                        <mat-form-field
                            appearance="outline"
                            floatLabel="always"
                            [matMenuTriggerFor]="attrSearcherMenu"
                            (click)="$event.stopPropagation(); setTabItemTo('CALENDAR', ind)"
                        >
                            <mat-label>{{ labels.field | translate }} {{ ind }}</mat-label>
                            <mat-select formControlName="tabItem" [placeholder]="labels.select | translate">
                                <mat-option
                                    style="display: none"
                                    *ngFor="let tabItem of originalData?.tabItems"
                                    [value]="tabItem"
                                    >{{ tabItem.frontName }}</mat-option
                                >
                            </mat-select>
                            <mat-error class="custom-actions-container__header__group__error" *ngIf="hasErrorIn('CALENDAR', ind)">
                                {{ labels.required | translate }}
                            </mat-error>
                        </mat-form-field>
                        <button
                            aria-label="Clear"
                            class="clear-field-button"
                            mat-icon-button
                            *ngIf="hasValue('CALENDAR', ind)"
                            (click)="clearField('CALENDAR', ind)"
                        >
                            <mat-icon>clear</mat-icon>
                        </button>
                    </section>
                </section>
            </div>
        </div>
    </div>
    <div class="card-config__item">
        <h2 class="card-config__item__title">{{ labels.tableView | translate }}</h2>
        <div class="card-config__item__card">
            <div class="card-config__item__card__colors">
                <div class="card-config__item__card__colors__color x-1"></div>
            </div>
            <div class="card-config__item__card__info table-view-info">
                <section formGroupName="TABLE">
                    <section class="field-section" *ngFor="let ind of getNumberOfFields('TABLE')" [formGroupName]="'field' + ind">
                        <mat-form-field
                            appearance="outline"
                            floatLabel="always"
                            [matMenuTriggerFor]="attrSearcherMenu"
                            (click)="$event.stopPropagation(); setTabItemTo('TABLE', ind)"
                        >
                            <mat-label>{{ labels.field | translate }} {{ ind }}</mat-label>
                            <mat-select formControlName="tabItem" [placeholder]="labels.select | translate">
                                <mat-option
                                    style="display: none"
                                    *ngFor="let tabItem of originalData?.tabItems"
                                    [value]="tabItem"
                                    >{{ tabItem.frontName }}</mat-option
                                >
                            </mat-select>
                            <mat-error class="custom-actions-container__header__group__error" *ngIf="hasErrorIn('TABLE', ind)">
                                {{ labels.required | translate }}
                            </mat-error>
                        </mat-form-field>
                        <button
                            aria-label="Clear"
                            class="clear-field-button"
                            mat-icon-button
                            *ngIf="hasValue('TABLE', ind)"
                            (click)="clearField('TABLE', ind)"
                        >
                            <mat-icon>clear</mat-icon>
                        </button>
                        <button
                            aria-label="Delete"
                            class="delete-field-button"
                            mat-icon-button
                            *ngIf="isLastFieldAndNotFirst('TABLE', ind)"
                            (click)="deleteField('TABLE', ind)"
                        >
                            <mat-icon>delete_outline</mat-icon>
                        </button>
                    </section>
                    <button mat-stroked-button color="primary" class="add-field-button" (click)="addField('TABLE')">
                        + {{ labels.addField | translate }}
                    </button>
                </section>
            </div>
        </div>
    </div>
</form>

<button style="display: none" #menuTrigger="matMenuTrigger" [matMenuTriggerFor]="attrSearcherMenu"></button>
<mat-menu #attrSearcherMenu="matMenu" class="attr-menu">
    <div class="attr-dialog">
        <div class="attr-dialog__filter">
            <div class="attr-dialog__filter__form">
                <form class="smaller-mat-form-fields" fxLayout="row" fxLayoutAlign="end center" (ngSubmit)="filter()">
                    <mat-form-field appearance="outline" class="smaller-mat-form-fields__no-margin">
                        <input
                            type="text"
                            matInput
                            [placeholder]="labels.filter | translate"
                            [formControl]="filterTextSearchControl"
                            (keyup.enter)="filter()"
                            (click)="$event.stopPropagation()"
                        />
                    </mat-form-field>
                </form>
            </div>
            <div class="attr-dialog__content">
                <p class="attr-dialog__content__no-data" *ngIf="!dataSource.data?.length">{{ labels.noData | translate }}</p>
                <mat-tree [dataSource]="dataSource" [treeControl]="treeControl" class="attr-tree">
                    <mat-tree-node *matTreeNodeDef="let node" matTreeNodeToggle (click)="selectAttribute(node)">
                        <button mat-button>
                            <div
                                appHighlight
                                [searchedWords]="searchedWords$ | async"
                                [text]="node.name"
                                classToApply="selected"
                            ></div>
                            <mat-icon>keyboard_arrow_right</mat-icon>
                        </button>
                    </mat-tree-node>
                    <mat-nested-tree-node *matTreeNodeDef="let node; when: hasChild">
                        <div class="mat-tree-node mat-tree-group-node">
                            <button mat-button matTreeNodeToggle [attr.aria-label]="'Toggle ' + node.name">
                                <div
                                    appHighlight
                                    [searchedWords]="searchedWords$ | async"
                                    [text]="node.name"
                                    classToApply="selected"
                                ></div>
                                <mat-icon class="mat-icon-rtl-mirror">
                                    {{ treeControl.isExpanded(node) ? "expand_more" : "chevron_right" }}
                                </mat-icon>
                            </button>
                        </div>
                        <div [class.attr-tree-invisible]="!treeControl.isExpanded(node)" role="group">
                            <ng-container matTreeNodeOutlet></ng-container>
                        </div>
                    </mat-nested-tree-node>
                </mat-tree>
            </div>
        </div>
    </div>
</mat-menu>
