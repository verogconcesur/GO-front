<div class="create-edit-user-content" fxLayout="column" fxLayoutAlign="center center">
    <div *ngIf="!isModalModeActive()">
        <div class="create-edit-user-content__title mat-display-2">{{ labels.title | translate }}</div>
    </div>
    <div class="create-edit-user-content__form">
        <form [formGroup]="userForm" *ngIf="userForm" class="smaller-mat-form-fields">
            <!-- General Data -->
            <div class="user-data__section">
                <div class="user-data__section__title first-child">
                    {{ labels.data | translate }}
                </div>
                <div class="user-data__section__group" fxLayout="row wrap" fxLayoutAlign="space-between center">
                    <!-- Name -->
                    <mat-form-field appearance="outline" floatLabel="always">
                        <mat-label>{{ labels.name | translate }}</mat-label>
                        <input matInput formControlName="name" />
                        <mat-error
                            class="user-data__error"
                            *ngIf="userForm.controls.name.invalid && userForm.controls.name.touched"
                        >
                            {{ labels.nameRequired | translate }}
                        </mat-error>
                    </mat-form-field>
                    <!-- firstName -->
                    <mat-form-field appearance="outline" floatLabel="always">
                        <mat-label>{{ labels.firstName | translate }}</mat-label>
                        <input matInput formControlName="firstName" />
                        <mat-error
                            class="user-data__error"
                            *ngIf="userForm.controls.firstName.invalid && userForm.controls.firstName.touched"
                        >
                            {{ labels.firstNameRequired | translate }}
                        </mat-error>
                    </mat-form-field>
                    <!-- lastName -->
                    <mat-form-field appearance="outline" floatLabel="always">
                        <mat-label>{{ labels.lastName | translate }}</mat-label>
                        <input matInput formControlName="lastName" />
                    </mat-form-field>
                </div>

                <div class="user-data__section__group" fxLayout="row wrap" fxLayoutAlign="space-between center">
                    <!-- Email -->
                    <mat-form-field appearance="outline" floatLabel="always">
                        <mat-label>{{ labels.email | translate }}</mat-label>
                        <input matInput formControlName="email" />
                    </mat-form-field>
                    <!-- userName -->
                    <mat-form-field appearance="outline" floatLabel="always">
                        <mat-label>{{ labels.userName | translate }}</mat-label>
                        <input matInput formControlName="userName" />
                    </mat-form-field>
                    <!-- role -->
                    <mat-form-field appearance="outline" floatLabel="always">
                        <mat-label>{{ labels.role | translate }}</mat-label>
                        <mat-select formControlName="role">
                            <mat-option *ngFor="let role of rolesAsyncList | async" [value]="role">{{ role.name }}</mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>

                <!-- Customized flex in scss -->
                <div class="user-data__section__group password-group">
                    <!-- newPassword -->
                    <mat-form-field appearance="outline" floatLabel="always">
                        <mat-label>{{ labels.password1 | translate }}</mat-label>
                        <input matInput formControlName="newPassword" type="password" />
                        <mat-error
                            class="restore-password-content__error"
                            *ngIf="form.newPassword.errors && form.newPassword.touched"
                        >
                            <span *ngIf="form.newPassword.errors.required">{{ labels.passwordRequired | translate }}</span>
                            <span *ngIf="form.newPassword.errors.pattern">{{ labels.passwordPattern | translate }}</span>
                        </mat-error>
                    </mat-form-field>
                    <!-- newPasswordConfirmation -->
                    <mat-form-field appearance="outline" floatLabel="always">
                        <mat-label>{{ labels.password2 | translate }}</mat-label>
                        <input matInput formControlName="newPasswordConfirmation" type="password" />
                        <mat-error
                            class="restore-password-content__error"
                            *ngIf="form.newPasswordConfirmation.invalid && form.newPasswordConfirmation.touched"
                        >
                            <span *ngIf="form.newPasswordConfirmation.errors.required">{{
                                labels.passwordRequired | translate
                            }}</span>
                            <span *ngIf="form.newPasswordConfirmation.errors.matching">{{
                                labels.passwordMatch | translate
                            }}</span>
                        </mat-error>
                    </mat-form-field>
                </div>
            </div>

            <!-- Organization -->
            <div class="user-data__section">
                <div class="user-data__section__title">
                    {{ labels.organization | translate }}
                </div>

                <div class="user-data__section__group" fxLayout="row wrap" fxLayoutAlign="space-between center">
                    <!-- brands -->
                    <mat-form-field appearance="outline" floatLabel="always">
                        <mat-label>{{ labels.brand | translate }}</mat-label>
                        <mat-select formControlName="brands" multiple (selectionChange)="getFacilitiesOptions()">
                            <mat-option *ngFor="let brand of brandsAsyncList | async" [value]="brand">{{
                                brand.name
                            }}</mat-option>
                        </mat-select>
                    </mat-form-field>

                    <!-- facilities -->
                    <mat-form-field appearance="outline" floatLabel="always">
                        <mat-label>{{ labels.facility | translate }}</mat-label>
                        <mat-select
                            formControlName="facilities"
                            multiple
                            (selectionChange)="getDepartmentsOptions()"
                            [disabled]="!facilitiesList || !facilitiesList.length"
                        >
                            <mat-optgroup *ngFor="let group of facilitiesList" [label]="group.brandName">
                                <mat-option *ngFor="let facility of group.facilities" [value]="facility">
                                    {{ facility.name }}
                                </mat-option>
                            </mat-optgroup>
                        </mat-select>
                    </mat-form-field>
                    <!-- departments -->
                    <mat-form-field appearance="outline" floatLabel="always">
                        <mat-label>{{ labels.department | translate }}</mat-label>
                        <mat-select
                            formControlName="departments"
                            multiple
                            (selectionChange)="getSpecialtiesOptions()"
                            [disabled]="!departmentsList || !departmentsList.length"
                        >
                            <mat-optgroup *ngFor="let group of departmentsList" [label]="group.facilityName">
                                <mat-option *ngFor="let department of group.departments" [value]="department">
                                    {{ department.name }}
                                </mat-option>
                            </mat-optgroup>
                        </mat-select>
                    </mat-form-field>
                </div>

                <div class="user-data__section__group" fxLayout="row wrap" fxLayoutAlign="space-between center">
                    <!-- specialties -->
                    <mat-form-field appearance="outline" floatLabel="always">
                        <mat-label>{{ labels.specialty | translate }}</mat-label>
                        <mat-select
                            formControlName="specialties"
                            multiple
                            [disabled]="!specialtiesList || !specialtiesList.length"
                        >
                            <mat-optgroup *ngFor="let group of specialtiesList" [label]="group.departmentName">
                                <mat-option *ngFor="let specialty of group.specialties" [value]="specialty">
                                    {{ specialty.name }}
                                </mat-option>
                            </mat-optgroup>
                        </mat-select>
                    </mat-form-field>
                </div>
            </div>

            <!-- Permissions -->
            <div class="user-data__section permissions-section">
                <div class="user-data__section__title">
                    {{ labels.permissions | translate }}
                </div>
                <div class="user-data__section__info" *ngIf="!form.role.value">
                    <div class="inlineBlock">{{ labels.selectRoleFirst | translate }}</div>
                </div>
                <div class="user-data__section__info" *ngIf="form.role.value">
                    <div
                        class="inlineBlock"
                        [innerHtml]="labels.permissionsInheritFromRole | translate: { role: form.role.value.name }"
                    ></div>
                    <button
                        mat-button
                        color="primary"
                        *ngIf="permissionsListComponent.hasChangesRespectRolePermissions()"
                        (click)="permissionsListComponent.resetRolesPermissions()"
                    >
                        {{ labels.reset | translate }}
                    </button>
                </div>
                <app-users-permissions
                    #permissionsListComponent
                    [overFlowLayerLabel]="labels.selectRoleFirst"
                    [showOverFlowLayer]="form.role.value ? false : true"
                    [permissions]="form.role?.value?.permissions"
                ></app-users-permissions>
            </div>

            <!-- User's permissions -->
            <div class="user-data__section permissions-section">
                <div class="user-data__section__title">
                    {{ labels.userPermissions | translate }}
                </div>
                <div *ngFor="let permissionObj of userPermissions">
                    <mat-checkbox [checked]="permissionObj.checked" (change)="checkPermission(permissionObj, $event)">
                        {{ permissionObj.permission.description }}
                    </mat-checkbox>
                </div>
            </div>
        </form>
    </div>
    <div class="create-edit-user-content__buttons">
        <!-- TODO: buttons used when the component is not opened with customDialogService -->
    </div>
</div>
